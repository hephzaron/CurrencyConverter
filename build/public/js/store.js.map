{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/idb/lib/idb.js","public/js/store.js","public/js/vendor.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC5TA;;;;AACA;;;;;;AAEA,IAAM,gBAAgB,IAAI,gBAAJ,EAAtB;;AAEA;;;;;;AAMO,IAAM,0CAAiB,SAAjB,cAAiB,GAAM;AAClC,MAAM,YAAY,cAAI,IAAJ,CAAS,eAAT,EAA0B,CAA1B,EAA6B,UAAC,SAAD,EAAe;AAC5D,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,YAApC,CAAL,EAAwD;AACtD,aAAO,UAAU,iBAAV,CAA4B,YAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;;AAMA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cAAc,eAAd,EAAxB;AACA,WAAO,gBAAgB,IAAhB,GAAuB,IAAvB,CAA4B,UAAC,UAAD,EAAgB;AACjD,UAAI,CAAC,WAAW,OAAhB,EAAyB;AACvB,eAAO,QAAQ,MAAR,CAAe,2CAAf,CAAP;AACD;AACD,UAAM,cAAc,OAAO,IAAP,CAAY,WAAW,OAAvB,EAAgC,GAAhC,CAAoC,UAAC,GAAD,EAAS;AAC/D,YAAM,KAAK,GAAG,WAAH,CAAe,YAAf,EAA6B,WAA7B,CAAX;AACA,YAAM,gBAAgB,GAAG,WAAH,CAAe,YAAf,CAAtB;AACA,sBAAc,GAAd,CAAkB,WAAW,OAAX,CAAmB,GAAnB,CAAlB,EAA2C,GAA3C;AACA,eAAO,GAAG,QAAV;AACD,OALmB,CAApB;AAMA,aAAO,QAAQ,OAAR,CAAgB,WAAhB,CAAP;AACD,KAXM,CAAP;AAYD,GAdM,CAAP;AAeD,CAtBM;;AAwBP;;;;;;AAMO,IAAM,oDAAsB,SAAtB,mBAAsB,CAAC,IAAD,EAAU;AAAA,MACnC,YADmC,GACc,IADd,CACnC,YADmC;AAAA,MACrB,UADqB,GACc,IADd,CACrB,UADqB;AAAA,MACT,SADS,GACc,IADd,CACT,SADS;AAAA,MACE,OADF,GACc,IADd,CACE,OADF;;AAE3C,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,EAAmC,UAAC,SAAD,EAAe;AAClE,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,SAApC,CAAL,EAAqD;AACnD,aAAO,UAAU,iBAAV,CAA4B,SAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;AAKA,MAAI,QAAO,IAAP,yCAAO,IAAP,OAAgB,QAAhB,IAA4B,CAAC,IAAjC,EAAuC;AACvC,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cACrB,mBADqB,CACD,YADC,EACa,UADb,EACyB,SADzB,EACoC,OADpC,CAAxB;AAEA,WAAO,gBAAgB,IAAhB,CAAqB,UAAC,IAAD,EAAU;AACpC,UAAM,iBAAiB,OAAO,IAAP,CAAY,IAAZ,EAAkB,GAAlB,CAAsB,UAAC,GAAD,EAAS;AACpD,YAAM,KAAK,GAAG,WAAH,CAAe,SAAf,EAA0B,WAA1B,CAAX;AACA,YAAM,uBAAuB,GAAG,WAAH,CAAe,SAAf,CAA7B;AACA,6BAAqB,GAArB,CAAyB,KAAK,GAAL,CAAzB,EAAoC,GAApC;AACA,eAAO,GAAG,QAAV;AACD,OALsB,CAAvB;AAMA,aAAO,QAAQ,OAAR,CAAgB,cAAhB,CAAP;AACD,KARM,CAAP;AASD,GAZM,CAAP;AAaD,CArBM;;AAuBP;;;;;;AAMO,IAAM,gDAAoB,SAApB,iBAAoB,CAAC,OAAD,EAAa;AAAA,MACpC,MADoC,GACC,OADD,CACpC,MADoC;AAAA,MAC5B,YAD4B,GACC,OADD,CAC5B,YAD4B;AAAA,MACd,UADc,GACC,OADD,CACd,UADc;;AAE5C,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,EAAmC,UAAC,SAAD,EAAe;AAClE,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,gBAApC,CAAL,EAA4D;AAC1D,aAAO,UAAU,iBAAV,CAA4B,gBAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;AAKA,MAAI,QAAO,OAAP,yCAAO,OAAP,OAAmB,QAAnB,IAA+B,CAAC,OAApC,EAA6C;AAC7C,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cAAc,oBAAd,CAAmC,YAAnC,EAAiD,UAAjD,CAAxB;AACA,WAAO,gBAAgB,IAAhB,CAAqB,UAAC,IAAD,EAAU;AACpC,UAAM,mBAAmB,OAAO,IAAP,CAAY,IAAZ,EAAkB,GAAlB,CAAsB,UAAC,GAAD,EAAS;AACtD,YAAM,KAAK,GAAG,WAAH,CAAe,gBAAf,EAAiC,WAAjC,CAAX;AACA,YAAM,gBAAgB,GAAG,WAAH,CAAe,gBAAf,CAAtB;AACA,sBAAc,GAAd,CAAkB,KAAK,GAAL,CAAlB,EAA6B,GAA7B;AACA,eAAO,GAAG,QAAV;AACD,OALwB,CAAzB;AAMA,aAAO,QAAQ,OAAR,CAAgB,gBAAhB,CAAP;AACD,KARM,CAAP;AASD,GAXM,CAAP;AAYD,CApBM;;AAsBP;;;;;;AAMO,IAAM,wCAAgB,SAAhB,aAAgB,GAAM;AACjC,MAAM,YAAY,cAAI,IAAJ,CAAS,eAAT,EAA0B,CAA1B,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,YAAf,CAAX;AACA,QAAM,gBAAgB,GAAG,WAAH,CAAe,YAAf,CAAtB;AACA,WAAO,cAAc,MAAd,EAAP;AACD,GAJM,CAAP;AAKD,CAPM;;AASP;;;;;;;AAOO,IAAM,4CAAkB,SAAlB,eAAkB,CAAC,YAAD,EAAe,UAAf,EAA8B;AAC3D,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,gBAAf,CAAX;AACA,QAAM,oBAAoB,GAAG,WAAH,CAAe,gBAAf,CAA1B;AACA,QAAM,OAAO,kBAAkB,GAAlB,CAAyB,YAAzB,SAAyC,UAAzC,CAAb;AACA,WAAO,KAAK,IAAL,CAAU,UAAC,GAAD,EAAS;AACxB,UAAI,CAAC,GAAL,EAAU;AACV,aAAO,GAAP;AACD,KAHM,CAAP;AAID,GARM,CAAP;AASD,CAXM;;AAaP;;;;;;;AAOO,IAAM,kDAAqB,SAArB,kBAAqB,CAAC,YAAD,EAAe,UAAf,EAA8B;AAC9D,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,SAAf,CAAX;AACA,QAAM,uBAAuB,GAAG,WAAH,CAAe,SAAf,CAA7B;AACA,QAAM,SAAS,qBAAqB,GAArB,CAA4B,YAA5B,SAA4C,UAA5C,CAAf;AACA,WAAO,OAAO,IAAP,CAAY,UAAC,GAAD,EAAS;AAC1B,UAAI,CAAC,GAAL,EAAU;AACV,aAAO,GAAP;AACD,KAHM,CAAP;AAID,GARM,CAAP;AASD,CAXM;;kBAaQ,E;;;;;;;;;;;;;ICnJT,a;AACJ,2BAAc;AAAA;;AACZ,SAAK,OAAL,GAAe,8CAAf;AACD;;;;sCAEiB;AAChB,aAAO,MAAS,KAAK,OAAd,kBACJ,IADI,CACC;AAAA,eAAY,QAAZ;AAAA,OADD,EAEJ,KAFI,CAEE;AAAA,eAAS,QAAQ,GAAR,CAAY,KAAZ,CAAT;AAAA,OAFF,CAAP;AAGD;;;wCAEmB,Y,EAAc,U,EAAY,S,EAAW,O,EAAS;AAChE,UAAM,QAAW,YAAX,SAA2B,UAA3B,SAAyC,UAAzC,SAAuD,YAA7D;AACA,UAAM,MAAS,KAAK,OAAd,mBAAmC,KAAnC,4BAA+D,SAA/D,iBAAoF,OAA1F;AACA,aAAO,MAAM,GAAN,EACJ,IADI,CACC,UAAC,QAAD,EAAc;AAClB,YAAI,CAAC,QAAL,EAAe;AACf,eAAO,QAAP;AACD,OAJI,EAKJ,KALI,CAKE;AAAA,eAAS,QAAQ,GAAR,CAAY,KAAZ,CAAT;AAAA,OALF,CAAP;AAMD;;;;;;kBAGY,a","file":"store.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","import idb from 'idb';\r\nimport HandleRequest from './vendor';\r\n\r\nconst handleRequest = new HandleRequest();\r\n\r\n/**\r\n * Save currencies to db\r\n * @function saveCurrencies\r\n * @param { null } \r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencies = () => {\r\n  const dbPromise = idb.open('currencies-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('currencies')) {\r\n      return upgradeDb.createObjectStore('currencies');\r\n    }\r\n  });\r\n\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest.fetchCurrencies();\r\n    return fetchedResponse.json().then((currencies) => {\r\n      if (!currencies.results) {\r\n        return Promise.reject('Currencies cannot be fetched from network')\r\n      }\r\n      const addCurrency = Object.keys(currencies.results).map((key) => {\r\n        const tx = db.transaction('currencies', 'readwrite');\r\n        const currencyStore = tx.objectStore('currencies');\r\n        currencyStore.put(currencies.results[key], key);\r\n        return tx.complete;\r\n      });\r\n      return Promise.resolve(addCurrency);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Save currency history to db\r\n * @function saveCurrencyHistory\r\n * @param { object } data - currency data to be saved\r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencyHistory = (data) => {\r\n  const { fromCurrency, toCurrency, startDate, endDate } = data;\r\n  const dbPromise = idb.open('currency-history-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('history')) {\r\n      return upgradeDb.createObjectStore('history');\r\n    }\r\n  });\r\n  if (typeof data !== 'object' || !data) return;\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest\r\n      .fetchHistoricalData(fromCurrency, toCurrency, startDate, endDate);\r\n    return fetchedResponse.then((data) => {\r\n      const historicalData = Object.keys(data).map((key) => {\r\n        const tx = db.transaction('history', 'readwrite');\r\n        const currencyHistoryStore = tx.objectStore('history');\r\n        currencyHistoryStore.put(data[key], key);\r\n        return tx.complete\r\n      });\r\n      return Promise.resolve(historicalData);\r\n    });\r\n  })\r\n}\r\n\r\n/**\r\n * Save currency rates to db\r\n * @function saveCurrencyRates\r\n * @param { object } options - currency conversion rates to be saved \r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencyRates = (options) => {\r\n  const { amount, fromCurrency, toCurrency } = options;\r\n  const dbPromise = idb.open('currencies-rates-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('currency-rates')) {\r\n      return upgradeDb.createObjectStore('currency-rates');\r\n    }\r\n  });\r\n  if (typeof options !== 'object' || !options) return;\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest.fetchConversionRates(fromCurrency, toCurrency);\r\n    return fetchedResponse.then((data) => {\r\n      const addCurrencyRates = Object.keys(data).map((key) => {\r\n        const tx = db.transaction('currency-rates', 'readwrite');\r\n        const currencyStore = tx.objectStore('currency-rates');\r\n        currencyStore.put(data[key], key);\r\n        return tx.complete\r\n      });\r\n      return Promise.resolve(addCurrencyRates);\r\n    });\r\n  })\r\n}\r\n\r\n/**\r\n * Get currencies from idb object store\r\n * @function getCurrencies\r\n * @param { null } \r\n * @returns { promise } currencies\r\n */\r\nexport const getCurrencies = () => {\r\n  const dbPromise = idb.open('currencies-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('currencies');\r\n    const currencyStore = tx.objectStore('currencies');\r\n    return currencyStore.getAll();\r\n  });\r\n}\r\n\r\n/**\r\n * Get currency rate from idb object store\r\n * @function getCurrencyRate\r\n * @param { string } fromCurrency - initiator\r\n * @param { string } toCurrency - receiver\r\n * @returns { promise } currencies\r\n */\r\nexport const getCurrencyRate = (fromCurrency, toCurrency) => {\r\n  const dbPromise = idb.open('currencies-rates-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('currency-rates');\r\n    const currencyRateStore = tx.objectStore('currency-rates');\r\n    const rate = currencyRateStore.get(`${fromCurrency}_${toCurrency}`);\r\n    return rate.then((res) => {\r\n      if (!res) return;\r\n      return res;\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get currency history from idb object store\r\n * @function getCurrencyHistory\r\n * @param { string } fromCurrency - initiator\r\n * @param { string } toCurrency - receiver\r\n * @returns { promise } result\r\n */\r\nexport const getCurrencyHistory = (fromCurrency, toCurrency) => {\r\n  const dbPromise = idb.open('currency-history-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('history');\r\n    const currencyHistoryStore = tx.objectStore('history');\r\n    const result = currencyHistoryStore.get(`${fromCurrency}_${toCurrency}`);\r\n    return result.then((res) => {\r\n      if (!res) return;\r\n      return res\r\n    })\r\n  })\r\n}\r\n\r\nexport default {};","class HandleRequest {\r\n  constructor() {\r\n    this.baseUrl = 'https://free.currencyconverterapi.com/api/v5';\r\n  }\r\n\r\n  fetchCurrencies() {\r\n    return fetch(`${this.baseUrl}/currencies`)\r\n      .then(response => response)\r\n      .catch(error => console.log(error))\r\n  }\r\n\r\n  fetchHistoricalData(fromCurrency, toCurrency, startDate, endDate) {\r\n    const query = `${fromCurrency}_${toCurrency},${toCurrency}_${fromCurrency}`;\r\n    const url = `${this.baseUrl}/convert?q=${query}&compact=ultra&date=${startDate}&endDate=${endDate}`\r\n    return fetch(url)\r\n      .then((response) => {\r\n        if (!response) return;\r\n        return response\r\n      })\r\n      .catch(error => console.log(error))\r\n  }\r\n}\r\n\r\nexport default HandleRequest;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJwdWJsaWMvanMvc3RvcmUuanMiLCJwdWJsaWMvanMvdmVuZG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUM1VEE7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTSxnQkFBZ0IsSUFB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QixHQUFHLFdBQUgsQ0FBZSxTQUFmLENBQTdCO0FBQ0EsUUFBTSxTQUFTLHFCQUFxQixHQUFyQixDQUE0QixZQUE1QixTQUE0QyxVQUE1QyxDQUFmO0FBQ0EsV0FBTyxPQUFPLElBQVAsQ0FBWSxVQUFDLEdBQUQsRUFBUztBQUMxQixVQUFJLENBQUMsR0FBTCxFQUFVO0FBQ1YsYUFBTyxHQUFQO0FBQ0QsS0FITSxDQUFQO0FBSUQsR0FSTSxDQUFQO0FBU0QsQ0FYTTs7a0JBYVEsRTs7Ozs7Ozs7Ozs7OztJQ25KVCxhO0FBQ0osMkJBQWM7QUFBQTs7QUFDWixTQUFLLE9BQUwsR0FBZSw4Q0FBZjtBQUNEOzs7O3NDQUVpQjtBQUNoQixhQUFPLE1BQVMsS0FBSyxPQUFkLGtCQUNKLElBREksQ0FDQztBQUFBLGVBQVksUUFBWjtBQUFBLE9BREQsRUFFSixLQUZJLENBRUU7QUFBQSxlQUFTLFFBQVEsR0FBUixDQUFZLEtBQVosQ0FBVDtBQUFBLE9BRkYsQ0FBUDtBQUdEOzs7d0NBRW1CLFksRUFBYyxVLEVBQVksUyxFQUFXLE8sRUFBUztBQUNoRSxVQUFNLFFBQVcsWUFBWCxTQUEyQixVQUEzQixTQUF5QyxVQUF6QyxTQUF1RCxZQUE3RDtBQUNBLFVBQU0sTUFBUyxLQUFLLE9BQWQsbUJBQW1DLEtBQW5DLDRCQUErRCxTQUEvRCxpQkFBb0YsT0FBMUY7QUFDQSxhQUFPLE1BQU0sR0FBTixFQUNKLElBREksQ0FDQyxVQUFDLFFBQUQsRUFBYztBQUNsQixZQUFJLENBQUMsUUFBTCxFQUFlO0FBQ2YsZUFBTyxRQUFQO0FBQ0QsT0FKSSxFQUtKLEtBTEksQ0FLRTtBQUFBLGVBQVMsUUFBUSxHQUFSLENBQVksS0FBWixDQUFUO0FBQUEsT0FMRixDQUFQO0FBTUQ7Ozs7OztrQkFHWSxhIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7XG4iLCJpbXBvcnQgaWRiIGZyb20gJ2lkYic7XHJcbmltcG9ydCBIYW5kbGVSZXF1ZXN0IGZyb20gJy4vdmVuZG9yJztcclxuXHJcbmNvbnN0IGhhbmRsZVJlcXVlc3QgPSBuZXcgSGFuZGxlUmVxdWVzdCgpO1xyXG5cclxuLyoqXHJcbiAqIFNhdmUgY3VycmVuY2llcyB0byBkYlxyXG4gKiBAZnVuY3Rpb24gc2F2ZUN1cnJlbmNpZXNcclxuICogQHBhcmFtIHsgbnVsbCB9IFxyXG4gKiBAcmV0dXJucyB7IHByb21pc2UgfSBpZGIgb2JqZWN0XHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc2F2ZUN1cnJlbmNpZXMgPSAoKSA9PiB7XHJcbiAgY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oJ2N1cnJlbmNpZXMtZGInLCAxLCAodXBncmFkZURiKSA9PiB7XHJcbiAgICBpZiAoIXVwZ3JhZGVEYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKCdjdXJyZW5jaWVzJykpIHtcclxuICAgICAgcmV0dXJuIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnY3VycmVuY2llcycpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gZGJQcm9taXNlLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBjb25zdCBmZXRjaGVkUmVzcG9uc2UgPSBoYW5kbGVSZXF1ZXN0LmZldGNoQ3VycmVuY2llcygpO1xyXG4gICAgcmV0dXJuIGZldGNoZWRSZXNwb25zZS5qc29uKCkudGhlbigoY3VycmVuY2llcykgPT4ge1xyXG4gICAgICBpZiAoIWN1cnJlbmNpZXMucmVzdWx0cykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnQ3VycmVuY2llcyBjYW5ub3QgYmUgZmV0Y2hlZCBmcm9tIG5ldHdvcmsnKVxyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGFkZEN1cnJlbmN5ID0gT2JqZWN0LmtleXMoY3VycmVuY2llcy5yZXN1bHRzKS5tYXAoKGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2N1cnJlbmNpZXMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVuY3lTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdjdXJyZW5jaWVzJyk7XHJcbiAgICAgICAgY3VycmVuY3lTdG9yZS5wdXQoY3VycmVuY2llcy5yZXN1bHRzW2tleV0sIGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhZGRDdXJyZW5jeSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNhdmUgY3VycmVuY3kgaGlzdG9yeSB0byBkYlxyXG4gKiBAZnVuY3Rpb24gc2F2ZUN1cnJlbmN5SGlzdG9yeVxyXG4gKiBAcGFyYW0geyBvYmplY3QgfSBkYXRhIC0gY3VycmVuY3kgZGF0YSB0byBiZSBzYXZlZFxyXG4gKiBAcmV0dXJucyB7IHByb21pc2UgfSBpZGIgb2JqZWN0XHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc2F2ZUN1cnJlbmN5SGlzdG9yeSA9IChkYXRhKSA9PiB7XHJcbiAgY29uc3QgeyBmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3ksIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9ID0gZGF0YTtcclxuICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbignY3VycmVuY3ktaGlzdG9yeS1kYicsIDEsICh1cGdyYWRlRGIpID0+IHtcclxuICAgIGlmICghdXBncmFkZURiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ2hpc3RvcnknKSkge1xyXG4gICAgICByZXR1cm4gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdoaXN0b3J5Jyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgaWYgKHR5cGVvZiBkYXRhICE9PSAnb2JqZWN0JyB8fCAhZGF0YSkgcmV0dXJuO1xyXG4gIHJldHVybiBkYlByb21pc2UudGhlbigoZGIpID0+IHtcclxuICAgIGNvbnN0IGZldGNoZWRSZXNwb25zZSA9IGhhbmRsZVJlcXVlc3RcclxuICAgICAgLmZldGNoSGlzdG9yaWNhbERhdGEoZnJvbUN1cnJlbmN5LCB0b0N1cnJlbmN5LCBzdGFydERhdGUsIGVuZERhdGUpO1xyXG4gICAgcmV0dXJuIGZldGNoZWRSZXNwb25zZS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGhpc3RvcmljYWxEYXRhID0gT2JqZWN0LmtleXMoZGF0YSkubWFwKChrZXkpID0+IHtcclxuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdoaXN0b3J5JywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbmN5SGlzdG9yeVN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ2hpc3RvcnknKTtcclxuICAgICAgICBjdXJyZW5jeUhpc3RvcnlTdG9yZS5wdXQoZGF0YVtrZXldLCBrZXkpO1xyXG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShoaXN0b3JpY2FsRGF0YSk7XHJcbiAgICB9KTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogU2F2ZSBjdXJyZW5jeSByYXRlcyB0byBkYlxyXG4gKiBAZnVuY3Rpb24gc2F2ZUN1cnJlbmN5UmF0ZXNcclxuICogQHBhcmFtIHsgb2JqZWN0IH0gb3B0aW9ucyAtIGN1cnJlbmN5IGNvbnZlcnNpb24gcmF0ZXMgdG8gYmUgc2F2ZWQgXHJcbiAqIEByZXR1cm5zIHsgcHJvbWlzZSB9IGlkYiBvYmplY3RcclxuICovXHJcbmV4cG9ydCBjb25zdCBzYXZlQ3VycmVuY3lSYXRlcyA9IChvcHRpb25zKSA9PiB7XHJcbiAgY29uc3QgeyBhbW91bnQsIGZyb21DdXJyZW5jeSwgdG9DdXJyZW5jeSB9ID0gb3B0aW9ucztcclxuICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbignY3VycmVuY2llcy1yYXRlcy1kYicsIDEsICh1cGdyYWRlRGIpID0+IHtcclxuICAgIGlmICghdXBncmFkZURiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ2N1cnJlbmN5LXJhdGVzJykpIHtcclxuICAgICAgcmV0dXJuIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnY3VycmVuY3ktcmF0ZXMnKTtcclxuICAgIH1cclxuICB9KTtcclxuICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICdvYmplY3QnIHx8ICFvcHRpb25zKSByZXR1cm47XHJcbiAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKChkYikgPT4ge1xyXG4gICAgY29uc3QgZmV0Y2hlZFJlc3BvbnNlID0gaGFuZGxlUmVxdWVzdC5mZXRjaENvbnZlcnNpb25SYXRlcyhmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3kpO1xyXG4gICAgcmV0dXJuIGZldGNoZWRSZXNwb25zZS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGFkZEN1cnJlbmN5UmF0ZXMgPSBPYmplY3Qua2V5cyhkYXRhKS5tYXAoKGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2N1cnJlbmN5LXJhdGVzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbmN5U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnY3VycmVuY3ktcmF0ZXMnKTtcclxuICAgICAgICBjdXJyZW5jeVN0b3JlLnB1dChkYXRhW2tleV0sIGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGFkZEN1cnJlbmN5UmF0ZXMpO1xyXG4gICAgfSk7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW5jaWVzIGZyb20gaWRiIG9iamVjdCBzdG9yZVxyXG4gKiBAZnVuY3Rpb24gZ2V0Q3VycmVuY2llc1xyXG4gKiBAcGFyYW0geyBudWxsIH0gXHJcbiAqIEByZXR1cm5zIHsgcHJvbWlzZSB9IGN1cnJlbmNpZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZXRDdXJyZW5jaWVzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdjdXJyZW5jaWVzLWRiJywgMSk7XHJcbiAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKChkYikgPT4ge1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY3VycmVuY2llcycpO1xyXG4gICAgY29uc3QgY3VycmVuY3lTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdjdXJyZW5jaWVzJyk7XHJcbiAgICByZXR1cm4gY3VycmVuY3lTdG9yZS5nZXRBbGwoKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW5jeSByYXRlIGZyb20gaWRiIG9iamVjdCBzdG9yZVxyXG4gKiBAZnVuY3Rpb24gZ2V0Q3VycmVuY3lSYXRlXHJcbiAqIEBwYXJhbSB7IHN0cmluZyB9IGZyb21DdXJyZW5jeSAtIGluaXRpYXRvclxyXG4gKiBAcGFyYW0geyBzdHJpbmcgfSB0b0N1cnJlbmN5IC0gcmVjZWl2ZXJcclxuICogQHJldHVybnMgeyBwcm9taXNlIH0gY3VycmVuY2llc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldEN1cnJlbmN5UmF0ZSA9IChmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3kpID0+IHtcclxuICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbignY3VycmVuY2llcy1yYXRlcy1kYicsIDEpO1xyXG4gIHJldHVybiBkYlByb21pc2UudGhlbigoZGIpID0+IHtcclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2N1cnJlbmN5LXJhdGVzJyk7XHJcbiAgICBjb25zdCBjdXJyZW5jeVJhdGVTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdjdXJyZW5jeS1yYXRlcycpO1xyXG4gICAgY29uc3QgcmF0ZSA9IGN1cnJlbmN5UmF0ZVN0b3JlLmdldChgJHtmcm9tQ3VycmVuY3l9XyR7dG9DdXJyZW5jeX1gKTtcclxuICAgIHJldHVybiByYXRlLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAoIXJlcykgcmV0dXJuO1xyXG4gICAgICByZXR1cm4gcmVzO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVuY3kgaGlzdG9yeSBmcm9tIGlkYiBvYmplY3Qgc3RvcmVcclxuICogQGZ1bmN0aW9uIGdldEN1cnJlbmN5SGlzdG9yeVxyXG4gKiBAcGFyYW0geyBzdHJpbmcgfSBmcm9tQ3VycmVuY3kgLSBpbml0aWF0b3JcclxuICogQHBhcmFtIHsgc3RyaW5nIH0gdG9DdXJyZW5jeSAtIHJlY2VpdmVyXHJcbiAqIEByZXR1cm5zIHsgcHJvbWlzZSB9IHJlc3VsdFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldEN1cnJlbmN5SGlzdG9yeSA9IChmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3kpID0+IHtcclxuICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbignY3VycmVuY3ktaGlzdG9yeS1kYicsIDEpO1xyXG4gIHJldHVybiBkYlByb21pc2UudGhlbigoZGIpID0+IHtcclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2hpc3RvcnknKTtcclxuICAgIGNvbnN0IGN1cnJlbmN5SGlzdG9yeVN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ2hpc3RvcnknKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGN1cnJlbmN5SGlzdG9yeVN0b3JlLmdldChgJHtmcm9tQ3VycmVuY3l9XyR7dG9DdXJyZW5jeX1gKTtcclxuICAgIHJldHVybiByZXN1bHQudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmICghcmVzKSByZXR1cm47XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgIH0pXHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQge307IiwiY2xhc3MgSGFuZGxlUmVxdWVzdCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmJhc2VVcmwgPSAnaHR0cHM6Ly9mcmVlLmN1cnJlbmN5Y29udmVydGVyYXBpLmNvbS9hcGkvdjUnO1xyXG4gIH1cclxuXHJcbiAgZmV0Y2hDdXJyZW5jaWVzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY3VycmVuY2llc2ApXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlKVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKVxyXG4gIH1cclxuXHJcbiAgZmV0Y2hIaXN0b3JpY2FsRGF0YShmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3ksIHN0YXJ0RGF0ZSwgZW5kRGF0ZSkge1xyXG4gICAgY29uc3QgcXVlcnkgPSBgJHtmcm9tQ3VycmVuY3l9XyR7dG9DdXJyZW5jeX0sJHt0b0N1cnJlbmN5fV8ke2Zyb21DdXJyZW5jeX1gO1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9jb252ZXJ0P3E9JHtxdWVyeX0mY29tcGFjdD11bHRyYSZkYXRlPSR7c3RhcnREYXRlfSZlbmREYXRlPSR7ZW5kRGF0ZX1gXHJcbiAgICByZXR1cm4gZmV0Y2godXJsKVxyXG4gICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlKSByZXR1cm47XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIYW5kbGVSZXF1ZXN0OyJdfQ=="}