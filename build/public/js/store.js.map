{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/idb/lib/idb.js","public/js/store.js","public/js/vendor.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC5TA;;;;AACA;;;;;;AAEA,IAAM,gBAAgB,IAAI,gBAAJ,EAAtB;;AAEA;;;;;;AAMO,IAAM,0CAAiB,SAAjB,cAAiB,GAAM;AAClC,MAAM,YAAY,cAAI,IAAJ,CAAS,eAAT,EAA0B,CAA1B,EAA6B,UAAC,SAAD,EAAe;AAC5D,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,YAApC,CAAL,EAAwD;AACtD,aAAO,UAAU,iBAAV,CAA4B,YAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;;AAMA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cAAc,eAAd,EAAxB;AACA,WAAO,gBAAgB,IAAhB,GAAuB,IAAvB,CAA4B,UAAC,UAAD,EAAgB;AACjD,UAAI,CAAC,WAAW,OAAhB,EAAyB;AACvB,eAAO,QAAQ,MAAR,CAAe,2CAAf,CAAP;AACD;AACD,UAAM,cAAc,OAAO,IAAP,CAAY,WAAW,OAAvB,EAAgC,GAAhC,CAAoC,UAAC,GAAD,EAAS;AAC/D,YAAM,KAAK,GAAG,WAAH,CAAe,YAAf,EAA6B,WAA7B,CAAX;AACA,YAAM,gBAAgB,GAAG,WAAH,CAAe,YAAf,CAAtB;AACA,sBAAc,GAAd,CAAkB,WAAW,OAAX,CAAmB,GAAnB,CAAlB,EAA2C,GAA3C;AACA,eAAO,GAAG,QAAV;AACD,OALmB,CAApB;AAMA,aAAO,QAAQ,OAAR,CAAgB,WAAhB,CAAP;AACD,KAXM,CAAP;AAYD,GAdM,CAAP;AAeD,CAtBM;;AAwBP;;;;;;AAMO,IAAM,oDAAsB,SAAtB,mBAAsB,CAAC,IAAD,EAAU;AAAA,MACnC,YADmC,GACc,IADd,CACnC,YADmC;AAAA,MACrB,UADqB,GACc,IADd,CACrB,UADqB;AAAA,MACT,SADS,GACc,IADd,CACT,SADS;AAAA,MACE,OADF,GACc,IADd,CACE,OADF;;AAE3C,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,EAAmC,UAAC,SAAD,EAAe;AAClE,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,SAApC,CAAL,EAAqD;AACnD,aAAO,UAAU,iBAAV,CAA4B,SAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;AAKA,MAAI,QAAO,IAAP,yCAAO,IAAP,OAAgB,QAAhB,IAA4B,CAAC,IAAjC,EAAuC;AACvC,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cACrB,mBADqB,CACD,YADC,EACa,UADb,EACyB,SADzB,EACoC,OADpC,CAAxB;AAEA,WAAO,gBAAgB,IAAhB,CAAqB,UAAC,IAAD,EAAU;AACpC,UAAM,iBAAiB,OAAO,IAAP,CAAY,IAAZ,EAAkB,GAAlB,CAAsB,UAAC,GAAD,EAAS;AACpD,YAAM,KAAK,GAAG,WAAH,CAAe,SAAf,EAA0B,WAA1B,CAAX;AACA,YAAM,uBAAuB,GAAG,WAAH,CAAe,SAAf,CAA7B;AACA,6BAAqB,GAArB,CAAyB,KAAK,GAAL,CAAzB,EAAoC,GAApC;AACA,eAAO,GAAG,QAAV;AACD,OALsB,CAAvB;AAMA,aAAO,QAAQ,OAAR,CAAgB,cAAhB,CAAP;AACD,KARM,CAAP;AASD,GAZM,CAAP;AAaD,CArBM;;AAuBP;;;;;;AAMO,IAAM,gDAAoB,SAApB,iBAAoB,CAAC,OAAD,EAAa;AAAA,MACpC,MADoC,GACC,OADD,CACpC,MADoC;AAAA,MAC5B,YAD4B,GACC,OADD,CAC5B,YAD4B;AAAA,MACd,UADc,GACC,OADD,CACd,UADc;;AAE5C,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,EAAmC,UAAC,SAAD,EAAe;AAClE,QAAI,CAAC,UAAU,gBAAV,CAA2B,QAA3B,CAAoC,gBAApC,CAAL,EAA4D;AAC1D,aAAO,UAAU,iBAAV,CAA4B,gBAA5B,CAAP;AACD;AACF,GAJiB,CAAlB;AAKA,MAAI,QAAO,OAAP,yCAAO,OAAP,OAAmB,QAAnB,IAA+B,CAAC,OAApC,EAA6C;AAC7C,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,kBAAkB,cAAc,oBAAd,CAAmC,YAAnC,EAAiD,UAAjD,CAAxB;AACA,WAAO,gBAAgB,IAAhB,CAAqB,UAAC,IAAD,EAAU;AACpC,UAAM,mBAAmB,OAAO,IAAP,CAAY,IAAZ,EAAkB,GAAlB,CAAsB,UAAC,GAAD,EAAS;AACtD,YAAM,KAAK,GAAG,WAAH,CAAe,gBAAf,EAAiC,WAAjC,CAAX;AACA,YAAM,gBAAgB,GAAG,WAAH,CAAe,gBAAf,CAAtB;AACA,sBAAc,GAAd,CAAkB,KAAK,GAAL,CAAlB,EAA6B,GAA7B;AACA,eAAO,GAAG,QAAV;AACD,OALwB,CAAzB;AAMA,aAAO,QAAQ,OAAR,CAAgB,gBAAhB,CAAP;AACD,KARM,CAAP;AASD,GAXM,CAAP;AAYD,CApBM;;AAsBP;;;;;;AAMO,IAAM,wCAAgB,SAAhB,aAAgB,GAAM;AACjC,MAAM,YAAY,cAAI,IAAJ,CAAS,eAAT,EAA0B,CAA1B,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,YAAf,CAAX;AACA,QAAM,gBAAgB,GAAG,WAAH,CAAe,YAAf,CAAtB;AACA,WAAO,cAAc,MAAd,EAAP;AACD,GAJM,CAAP;AAKD,CAPM;;AASP;;;;;;;AAOO,IAAM,4CAAkB,SAAlB,eAAkB,CAAC,YAAD,EAAe,UAAf,EAA8B;AAC3D,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,gBAAf,CAAX;AACA,QAAM,oBAAoB,GAAG,WAAH,CAAe,gBAAf,CAA1B;AACA,QAAM,OAAO,kBAAkB,GAAlB,CAAyB,YAAzB,SAAyC,UAAzC,CAAb;AACA,WAAO,KAAK,IAAL,CAAU,UAAC,GAAD,EAAS;AACxB,UAAI,CAAC,GAAL,EAAU;AACV,aAAO,GAAP;AACD,KAHM,CAAP;AAID,GARM,CAAP;AASD,CAXM;;AAaP;;;;;;;AAOO,IAAM,kDAAqB,SAArB,kBAAqB,CAAC,YAAD,EAAe,UAAf,EAA8B;AAC9D,MAAM,YAAY,cAAI,IAAJ,CAAS,qBAAT,EAAgC,CAAhC,CAAlB;AACA,SAAO,UAAU,IAAV,CAAe,UAAC,EAAD,EAAQ;AAC5B,QAAM,KAAK,GAAG,WAAH,CAAe,SAAf,CAAX;AACA,QAAM,uBAAuB,GAAG,WAAH,CAAe,SAAf,CAA7B;AACA,QAAM,SAAS,qBAAqB,GAArB,CAA4B,YAA5B,SAA4C,UAA5C,CAAf;AACA,WAAO,OAAO,IAAP,CAAY,UAAC,GAAD,EAAS;AAC1B,UAAI,CAAC,GAAL,EAAU;AACV,aAAO,GAAP;AACD,KAHM,CAAP;AAID,GARM,CAAP;AASD,CAXM;;kBAaQ,E;;;;;;;;;;;;;ACnJf;;;;;IAKM,a;AACJ,2BAAc;AAAA;;AACZ,SAAK,OAAL,GAAe,8CAAf;AACD;;AAED;;;;;;;;;;;sCAOkB;AAChB,aAAO,MAAS,KAAK,OAAd,kBACJ,IADI,CACC;AAAA,eAAY,QAAZ;AAAA,OADD,EAEJ,KAFI,CAEE;AAAA,eAAS,QAAQ,GAAR,CAAY,KAAZ,CAAT;AAAA,OAFF,CAAP;AAGD;;AAED;;;;;;;;;;;;;wCAUoB,Y,EAAc,U,EAAY,S,EAAW,O,EAAS;AAChE,UAAM,QAAW,YAAX,SAA2B,UAA3B,SAAyC,UAAzC,SAAuD,YAA7D;AACA,UAAM,MAAS,KAAK,OAAd,mBAAmC,KAAnC,4BAA+D,SAA/D,iBAAoF,OAA1F;AACA,aAAO,MAAM,GAAN,EACJ,IADI,CACC,UAAC,QAAD,EAAc;AAClB,YAAI,CAAC,QAAL,EAAe;AACf,eAAO,QAAP;AACD,OAJI,EAKJ,KALI,CAKE;AAAA,eAAS,QAAQ,GAAR,CAAY,KAAZ,CAAT;AAAA,OALF,CAAP;AAMD;;;;;;kBAGY,a","file":"store.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","import idb from 'idb';\r\nimport HandleRequest from './vendor';\r\n\r\nconst handleRequest = new HandleRequest();\r\n\r\n/**\r\n * Save currencies to db\r\n * @function saveCurrencies\r\n * @param { null } \r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencies = () => {\r\n  const dbPromise = idb.open('currencies-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('currencies')) {\r\n      return upgradeDb.createObjectStore('currencies');\r\n    }\r\n  });\r\n\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest.fetchCurrencies();\r\n    return fetchedResponse.json().then((currencies) => {\r\n      if (!currencies.results) {\r\n        return Promise.reject('Currencies cannot be fetched from network')\r\n      }\r\n      const addCurrency = Object.keys(currencies.results).map((key) => {\r\n        const tx = db.transaction('currencies', 'readwrite');\r\n        const currencyStore = tx.objectStore('currencies');\r\n        currencyStore.put(currencies.results[key], key);\r\n        return tx.complete;\r\n      });\r\n      return Promise.resolve(addCurrency);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Save currency history to db\r\n * @function saveCurrencyHistory\r\n * @param { object } data - currency data to be saved\r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencyHistory = (data) => {\r\n  const { fromCurrency, toCurrency, startDate, endDate } = data;\r\n  const dbPromise = idb.open('currency-history-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('history')) {\r\n      return upgradeDb.createObjectStore('history');\r\n    }\r\n  });\r\n  if (typeof data !== 'object' || !data) return;\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest\r\n      .fetchHistoricalData(fromCurrency, toCurrency, startDate, endDate);\r\n    return fetchedResponse.then((data) => {\r\n      const historicalData = Object.keys(data).map((key) => {\r\n        const tx = db.transaction('history', 'readwrite');\r\n        const currencyHistoryStore = tx.objectStore('history');\r\n        currencyHistoryStore.put(data[key], key);\r\n        return tx.complete\r\n      });\r\n      return Promise.resolve(historicalData);\r\n    });\r\n  })\r\n}\r\n\r\n/**\r\n * Save currency rates to db\r\n * @function saveCurrencyRates\r\n * @param { object } options - currency conversion rates to be saved \r\n * @returns { promise } idb object\r\n */\r\nexport const saveCurrencyRates = (options) => {\r\n  const { amount, fromCurrency, toCurrency } = options;\r\n  const dbPromise = idb.open('currencies-rates-db', 1, (upgradeDb) => {\r\n    if (!upgradeDb.objectStoreNames.contains('currency-rates')) {\r\n      return upgradeDb.createObjectStore('currency-rates');\r\n    }\r\n  });\r\n  if (typeof options !== 'object' || !options) return;\r\n  return dbPromise.then((db) => {\r\n    const fetchedResponse = handleRequest.fetchConversionRates(fromCurrency, toCurrency);\r\n    return fetchedResponse.then((data) => {\r\n      const addCurrencyRates = Object.keys(data).map((key) => {\r\n        const tx = db.transaction('currency-rates', 'readwrite');\r\n        const currencyStore = tx.objectStore('currency-rates');\r\n        currencyStore.put(data[key], key);\r\n        return tx.complete\r\n      });\r\n      return Promise.resolve(addCurrencyRates);\r\n    });\r\n  })\r\n}\r\n\r\n/**\r\n * Get currencies from idb object store\r\n * @function getCurrencies\r\n * @param { null } \r\n * @returns { promise } currencies\r\n */\r\nexport const getCurrencies = () => {\r\n  const dbPromise = idb.open('currencies-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('currencies');\r\n    const currencyStore = tx.objectStore('currencies');\r\n    return currencyStore.getAll();\r\n  });\r\n}\r\n\r\n/**\r\n * Get currency rate from idb object store\r\n * @function getCurrencyRate\r\n * @param { string } fromCurrency - initiator\r\n * @param { string } toCurrency - receiver\r\n * @returns { promise } currencies\r\n */\r\nexport const getCurrencyRate = (fromCurrency, toCurrency) => {\r\n  const dbPromise = idb.open('currencies-rates-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('currency-rates');\r\n    const currencyRateStore = tx.objectStore('currency-rates');\r\n    const rate = currencyRateStore.get(`${fromCurrency}_${toCurrency}`);\r\n    return rate.then((res) => {\r\n      if (!res) return;\r\n      return res;\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get currency history from idb object store\r\n * @function getCurrencyHistory\r\n * @param { string } fromCurrency - initiator\r\n * @param { string } toCurrency - receiver\r\n * @returns { promise } result\r\n */\r\nexport const getCurrencyHistory = (fromCurrency, toCurrency) => {\r\n  const dbPromise = idb.open('currency-history-db', 1);\r\n  return dbPromise.then((db) => {\r\n    const tx = db.transaction('history');\r\n    const currencyHistoryStore = tx.objectStore('history');\r\n    const result = currencyHistoryStore.get(`${fromCurrency}_${toCurrency}`);\r\n    return result.then((res) => {\r\n      if (!res) return;\r\n      return res\r\n    })\r\n  })\r\n}\r\n\r\nexport default {};","/**\r\n * @class HandleRequest\r\n * @description Handle third party based api\r\n * @returns { null }\r\n */\r\nclass HandleRequest {\r\n  constructor() {\r\n    this.baseUrl = 'https://free.currencyconverterapi.com/api/v5';\r\n  }\r\n\r\n  /**\r\n   * @method fetchCurrencies\r\n   * @description fetch currency from newtork\r\n   * @memberof HandleRequest\r\n   * @param { null }\r\n   * @returns { promise } response - network response\r\n   */\r\n  fetchCurrencies() {\r\n    return fetch(`${this.baseUrl}/currencies`)\r\n      .then(response => response)\r\n      .catch(error => console.log(error))\r\n  }\r\n\r\n  /**\r\n   * @method fetchHistoricalData\r\n   * @description fetch currency history from newtork\r\n   * @memberof HandleRequest\r\n   * @param { string } fromCurrency - initiator\r\n   * @param { string } toCurrency - receiver\r\n   * @param { string } startDate\r\n   * @param { string } endDate\r\n   * @returns { promise } response - network response\r\n   */\r\n  fetchHistoricalData(fromCurrency, toCurrency, startDate, endDate) {\r\n    const query = `${fromCurrency}_${toCurrency},${toCurrency}_${fromCurrency}`;\r\n    const url = `${this.baseUrl}/convert?q=${query}&compact=ultra&date=${startDate}&endDate=${endDate}`\r\n    return fetch(url)\r\n      .then((response) => {\r\n        if (!response) return;\r\n        return response\r\n      })\r\n      .catch(error => console.log(error))\r\n  }\r\n}\r\n\r\nexport default HandleRequest;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJwdWJsaWMvanMvc3RvcmUuanMiLCJwdWJsaWMvanMvdmVuZG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUM1VEE7Ozs7QUFDQTs7Ozs7O0FBRUEsSUFBTSxnQkFBZ0IsSUFB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QixHQUFHLFdBQUgsQ0FBZSxTQUFmLENBQTdCO0FBQ0EsUUFBTSxTQUFTLHFCQUFxQixHQUFyQixDQUE0QixZQUE1QixTQUE0QyxVQUE1QyxDQUFmO0FBQ0EsV0FBTyxPQUFPLElBQVAsQ0FBWSxVQUFDLEdBQUQsRUFBUztBQUMxQixVQUFJLENBQUMsR0FBTCxFQUFVO0FBQ1YsYUFBTyxHQUFQO0FBQ0QsS0FITSxDQUFQO0FBSUQsR0FSTSxDQUFQO0FBU0QsQ0FYTTs7a0JBYVEsRTs7Ozs7Ozs7Ozs7OztBQ25KZjs7Ozs7SUFLTSxhO0FBQ0osMkJBQWM7QUFBQTs7QUFDWixTQUFLLE9BQUwsR0FBZSw4Q0FBZjtBQUNEOztBQUVEOzs7Ozs7Ozs7OztzQ0FPa0I7QUFDaEIsYUFBTyxNQUFTLEtBQUssT0FBZCxrQkFDSixJQURJLENBQ0M7QUFBQSxlQUFZLFFBQVo7QUFBQSxPQURELEVBRUosS0FGSSxDQUVFO0FBQUEsZUFBUyxRQUFRLEdBQVIsQ0FBWSxLQUFaLENBQVQ7QUFBQSxPQUZGLENBQVA7QUFHRDs7QUFFRDs7Ozs7Ozs7Ozs7Ozt3Q0FVb0IsWSxFQUFjLFUsRUFBWSxTLEVBQVcsTyxFQUFTO0FBQ2hFLFVBQU0sUUFBVyxZQUFYLFNBQTJCLFVBQTNCLFNBQXlDLFVBQXpDLFNBQXVELFlBQTdEO0FBQ0EsVUFBTSxNQUFTLEtBQUssT0FBZCxtQkFBbUMsS0FBbkMsNEJBQStELFNBQS9ELGlCQUFvRixPQUExRjtBQUNBLGFBQU8sTUFBTSxHQUFOLEVBQ0osSUFESSxDQUNDLFVBQUMsUUFBRCxFQUFjO0FBQ2xCLFlBQUksQ0FBQyxRQUFMLEVBQWU7QUFDZixlQUFPLFFBQVA7QUFDRCxPQUpJLEVBS0osS0FMSSxDQUtFO0FBQUEsZUFBUyxRQUFRLEdBQVIsQ0FBWSxLQUFaLENBQVQ7QUFBQSxPQUxGLENBQVA7QUFNRDs7Ozs7O2tCQUdZLGEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsImltcG9ydCBpZGIgZnJvbSAnaWRiJztcclxuaW1wb3J0IEhhbmRsZVJlcXVlc3QgZnJvbSAnLi92ZW5kb3InO1xyXG5cclxuY29uc3QgaGFuZGxlUmVxdWVzdCA9IG5ldyBIYW5kbGVSZXF1ZXN0KCk7XHJcblxyXG4vKipcclxuICogU2F2ZSBjdXJyZW5jaWVzIHRvIGRiXHJcbiAqIEBmdW5jdGlvbiBzYXZlQ3VycmVuY2llc1xyXG4gKiBAcGFyYW0geyBudWxsIH0gXHJcbiAqIEByZXR1cm5zIHsgcHJvbWlzZSB9IGlkYiBvYmplY3RcclxuICovXHJcbmV4cG9ydCBjb25zdCBzYXZlQ3VycmVuY2llcyA9ICgpID0+IHtcclxuICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbignY3VycmVuY2llcy1kYicsIDEsICh1cGdyYWRlRGIpID0+IHtcclxuICAgIGlmICghdXBncmFkZURiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ2N1cnJlbmNpZXMnKSkge1xyXG4gICAgICByZXR1cm4gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdjdXJyZW5jaWVzJyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBkYlByb21pc2UudGhlbigoZGIpID0+IHtcclxuICAgIGNvbnN0IGZldGNoZWRSZXNwb25zZSA9IGhhbmRsZVJlcXVlc3QuZmV0Y2hDdXJyZW5jaWVzKCk7XHJcbiAgICByZXR1cm4gZmV0Y2hlZFJlc3BvbnNlLmpzb24oKS50aGVuKChjdXJyZW5jaWVzKSA9PiB7XHJcbiAgICAgIGlmICghY3VycmVuY2llcy5yZXN1bHRzKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdDdXJyZW5jaWVzIGNhbm5vdCBiZSBmZXRjaGVkIGZyb20gbmV0d29yaycpXHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYWRkQ3VycmVuY3kgPSBPYmplY3Qua2V5cyhjdXJyZW5jaWVzLnJlc3VsdHMpLm1hcCgoa2V5KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY3VycmVuY2llcycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICBjb25zdCBjdXJyZW5jeVN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ2N1cnJlbmNpZXMnKTtcclxuICAgICAgICBjdXJyZW5jeVN0b3JlLnB1dChjdXJyZW5jaWVzLnJlc3VsdHNba2V5XSwga2V5KTtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGFkZEN1cnJlbmN5KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2F2ZSBjdXJyZW5jeSBoaXN0b3J5IHRvIGRiXHJcbiAqIEBmdW5jdGlvbiBzYXZlQ3VycmVuY3lIaXN0b3J5XHJcbiAqIEBwYXJhbSB7IG9iamVjdCB9IGRhdGEgLSBjdXJyZW5jeSBkYXRhIHRvIGJlIHNhdmVkXHJcbiAqIEByZXR1cm5zIHsgcHJvbWlzZSB9IGlkYiBvYmplY3RcclxuICovXHJcbmV4cG9ydCBjb25zdCBzYXZlQ3VycmVuY3lIaXN0b3J5ID0gKGRhdGEpID0+IHtcclxuICBjb25zdCB7IGZyb21DdXJyZW5jeSwgdG9DdXJyZW5jeSwgc3RhcnREYXRlLCBlbmREYXRlIH0gPSBkYXRhO1xyXG4gIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdjdXJyZW5jeS1oaXN0b3J5LWRiJywgMSwgKHVwZ3JhZGVEYikgPT4ge1xyXG4gICAgaWYgKCF1cGdyYWRlRGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucygnaGlzdG9yeScpKSB7XHJcbiAgICAgIHJldHVybiB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ2hpc3RvcnknKTtcclxuICAgIH1cclxuICB9KTtcclxuICBpZiAodHlwZW9mIGRhdGEgIT09ICdvYmplY3QnIHx8ICFkYXRhKSByZXR1cm47XHJcbiAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKChkYikgPT4ge1xyXG4gICAgY29uc3QgZmV0Y2hlZFJlc3BvbnNlID0gaGFuZGxlUmVxdWVzdFxyXG4gICAgICAuZmV0Y2hIaXN0b3JpY2FsRGF0YShmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3ksIHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XHJcbiAgICByZXR1cm4gZmV0Y2hlZFJlc3BvbnNlLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc3QgaGlzdG9yaWNhbERhdGEgPSBPYmplY3Qua2V5cyhkYXRhKS5tYXAoKGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2hpc3RvcnknLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVuY3lIaXN0b3J5U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnaGlzdG9yeScpO1xyXG4gICAgICAgIGN1cnJlbmN5SGlzdG9yeVN0b3JlLnB1dChkYXRhW2tleV0sIGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGhpc3RvcmljYWxEYXRhKTtcclxuICAgIH0pO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTYXZlIGN1cnJlbmN5IHJhdGVzIHRvIGRiXHJcbiAqIEBmdW5jdGlvbiBzYXZlQ3VycmVuY3lSYXRlc1xyXG4gKiBAcGFyYW0geyBvYmplY3QgfSBvcHRpb25zIC0gY3VycmVuY3kgY29udmVyc2lvbiByYXRlcyB0byBiZSBzYXZlZCBcclxuICogQHJldHVybnMgeyBwcm9taXNlIH0gaWRiIG9iamVjdFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHNhdmVDdXJyZW5jeVJhdGVzID0gKG9wdGlvbnMpID0+IHtcclxuICBjb25zdCB7IGFtb3VudCwgZnJvbUN1cnJlbmN5LCB0b0N1cnJlbmN5IH0gPSBvcHRpb25zO1xyXG4gIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdjdXJyZW5jaWVzLXJhdGVzLWRiJywgMSwgKHVwZ3JhZGVEYikgPT4ge1xyXG4gICAgaWYgKCF1cGdyYWRlRGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucygnY3VycmVuY3ktcmF0ZXMnKSkge1xyXG4gICAgICByZXR1cm4gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdjdXJyZW5jeS1yYXRlcycpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gJ29iamVjdCcgfHwgIW9wdGlvbnMpIHJldHVybjtcclxuICByZXR1cm4gZGJQcm9taXNlLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBjb25zdCBmZXRjaGVkUmVzcG9uc2UgPSBoYW5kbGVSZXF1ZXN0LmZldGNoQ29udmVyc2lvblJhdGVzKGZyb21DdXJyZW5jeSwgdG9DdXJyZW5jeSk7XHJcbiAgICByZXR1cm4gZmV0Y2hlZFJlc3BvbnNlLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc3QgYWRkQ3VycmVuY3lSYXRlcyA9IE9iamVjdC5rZXlzKGRhdGEpLm1hcCgoa2V5KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY3VycmVuY3ktcmF0ZXMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVuY3lTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdjdXJyZW5jeS1yYXRlcycpO1xyXG4gICAgICAgIGN1cnJlbmN5U3RvcmUucHV0KGRhdGFba2V5XSwga2V5KTtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGVcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYWRkQ3VycmVuY3lSYXRlcyk7XHJcbiAgICB9KTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbmNpZXMgZnJvbSBpZGIgb2JqZWN0IHN0b3JlXHJcbiAqIEBmdW5jdGlvbiBnZXRDdXJyZW5jaWVzXHJcbiAqIEBwYXJhbSB7IG51bGwgfSBcclxuICogQHJldHVybnMgeyBwcm9taXNlIH0gY3VycmVuY2llc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldEN1cnJlbmNpZXMgPSAoKSA9PiB7XHJcbiAgY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oJ2N1cnJlbmNpZXMtZGInLCAxKTtcclxuICByZXR1cm4gZGJQcm9taXNlLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdjdXJyZW5jaWVzJyk7XHJcbiAgICBjb25zdCBjdXJyZW5jeVN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ2N1cnJlbmNpZXMnKTtcclxuICAgIHJldHVybiBjdXJyZW5jeVN0b3JlLmdldEFsbCgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbmN5IHJhdGUgZnJvbSBpZGIgb2JqZWN0IHN0b3JlXHJcbiAqIEBmdW5jdGlvbiBnZXRDdXJyZW5jeVJhdGVcclxuICogQHBhcmFtIHsgc3RyaW5nIH0gZnJvbUN1cnJlbmN5IC0gaW5pdGlhdG9yXHJcbiAqIEBwYXJhbSB7IHN0cmluZyB9IHRvQ3VycmVuY3kgLSByZWNlaXZlclxyXG4gKiBAcmV0dXJucyB7IHByb21pc2UgfSBjdXJyZW5jaWVzXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVuY3lSYXRlID0gKGZyb21DdXJyZW5jeSwgdG9DdXJyZW5jeSkgPT4ge1xyXG4gIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdjdXJyZW5jaWVzLXJhdGVzLWRiJywgMSk7XHJcbiAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKChkYikgPT4ge1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY3VycmVuY3ktcmF0ZXMnKTtcclxuICAgIGNvbnN0IGN1cnJlbmN5UmF0ZVN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ2N1cnJlbmN5LXJhdGVzJyk7XHJcbiAgICBjb25zdCByYXRlID0gY3VycmVuY3lSYXRlU3RvcmUuZ2V0KGAke2Zyb21DdXJyZW5jeX1fJHt0b0N1cnJlbmN5fWApO1xyXG4gICAgcmV0dXJuIHJhdGUudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmICghcmVzKSByZXR1cm47XHJcbiAgICAgIHJldHVybiByZXM7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW5jeSBoaXN0b3J5IGZyb20gaWRiIG9iamVjdCBzdG9yZVxyXG4gKiBAZnVuY3Rpb24gZ2V0Q3VycmVuY3lIaXN0b3J5XHJcbiAqIEBwYXJhbSB7IHN0cmluZyB9IGZyb21DdXJyZW5jeSAtIGluaXRpYXRvclxyXG4gKiBAcGFyYW0geyBzdHJpbmcgfSB0b0N1cnJlbmN5IC0gcmVjZWl2ZXJcclxuICogQHJldHVybnMgeyBwcm9taXNlIH0gcmVzdWx0XHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVuY3lIaXN0b3J5ID0gKGZyb21DdXJyZW5jeSwgdG9DdXJyZW5jeSkgPT4ge1xyXG4gIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKCdjdXJyZW5jeS1oaXN0b3J5LWRiJywgMSk7XHJcbiAgcmV0dXJuIGRiUHJvbWlzZS50aGVuKChkYikgPT4ge1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignaGlzdG9yeScpO1xyXG4gICAgY29uc3QgY3VycmVuY3lIaXN0b3J5U3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnaGlzdG9yeScpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gY3VycmVuY3lIaXN0b3J5U3RvcmUuZ2V0KGAke2Zyb21DdXJyZW5jeX1fJHt0b0N1cnJlbmN5fWApO1xyXG4gICAgcmV0dXJuIHJlc3VsdC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKCFyZXMpIHJldHVybjtcclxuICAgICAgcmV0dXJuIHJlc1xyXG4gICAgfSlcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7fTsiLCIvKipcclxuICogQGNsYXNzIEhhbmRsZVJlcXVlc3RcclxuICogQGRlc2NyaXB0aW9uIEhhbmRsZSB0aGlyZCBwYXJ0eSBiYXNlZCBhcGlcclxuICogQHJldHVybnMgeyBudWxsIH1cclxuICovXHJcbmNsYXNzIEhhbmRsZVJlcXVlc3Qge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5iYXNlVXJsID0gJ2h0dHBzOi8vZnJlZS5jdXJyZW5jeWNvbnZlcnRlcmFwaS5jb20vYXBpL3Y1JztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBtZXRob2QgZmV0Y2hDdXJyZW5jaWVzXHJcbiAgICogQGRlc2NyaXB0aW9uIGZldGNoIGN1cnJlbmN5IGZyb20gbmV3dG9ya1xyXG4gICAqIEBtZW1iZXJvZiBIYW5kbGVSZXF1ZXN0XHJcbiAgICogQHBhcmFtIHsgbnVsbCB9XHJcbiAgICogQHJldHVybnMgeyBwcm9taXNlIH0gcmVzcG9uc2UgLSBuZXR3b3JrIHJlc3BvbnNlXHJcbiAgICovXHJcbiAgZmV0Y2hDdXJyZW5jaWVzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY3VycmVuY2llc2ApXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlKVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG1ldGhvZCBmZXRjaEhpc3RvcmljYWxEYXRhXHJcbiAgICogQGRlc2NyaXB0aW9uIGZldGNoIGN1cnJlbmN5IGhpc3RvcnkgZnJvbSBuZXd0b3JrXHJcbiAgICogQG1lbWJlcm9mIEhhbmRsZVJlcXVlc3RcclxuICAgKiBAcGFyYW0geyBzdHJpbmcgfSBmcm9tQ3VycmVuY3kgLSBpbml0aWF0b3JcclxuICAgKiBAcGFyYW0geyBzdHJpbmcgfSB0b0N1cnJlbmN5IC0gcmVjZWl2ZXJcclxuICAgKiBAcGFyYW0geyBzdHJpbmcgfSBzdGFydERhdGVcclxuICAgKiBAcGFyYW0geyBzdHJpbmcgfSBlbmREYXRlXHJcbiAgICogQHJldHVybnMgeyBwcm9taXNlIH0gcmVzcG9uc2UgLSBuZXR3b3JrIHJlc3BvbnNlXHJcbiAgICovXHJcbiAgZmV0Y2hIaXN0b3JpY2FsRGF0YShmcm9tQ3VycmVuY3ksIHRvQ3VycmVuY3ksIHN0YXJ0RGF0ZSwgZW5kRGF0ZSkge1xyXG4gICAgY29uc3QgcXVlcnkgPSBgJHtmcm9tQ3VycmVuY3l9XyR7dG9DdXJyZW5jeX0sJHt0b0N1cnJlbmN5fV8ke2Zyb21DdXJyZW5jeX1gO1xyXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9jb252ZXJ0P3E9JHtxdWVyeX0mY29tcGFjdD11bHRyYSZkYXRlPSR7c3RhcnREYXRlfSZlbmREYXRlPSR7ZW5kRGF0ZX1gXHJcbiAgICByZXR1cm4gZmV0Y2godXJsKVxyXG4gICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlKSByZXR1cm47XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIYW5kbGVSZXF1ZXN0OyJdfQ=="}